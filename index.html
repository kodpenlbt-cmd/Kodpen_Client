<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KODPEN COFFEE - Official Order</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');
        :root { --sb-green: #00704A; --sb-dark: #1E3932; }
        body { font-family: 'Montserrat', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        
        .btn-emboss {
            box-shadow: 0 6px 0 #004d33, 0 8px 15px rgba(0,0,0,0.2);
            transition: all 0.1s ease;
            position: relative;
            top: 0;
        }
        .btn-emboss:active:not(:disabled) {
            top: 4px;
            box-shadow: 0 2px 0 #004d33, 0 4px 6px rgba(0,0,0,0.2);
        }
        .btn-emboss:disabled {
            box-shadow: none;
            top: 0;
            opacity: 0.5;
            filter: grayscale(0.5);
            cursor: not-allowed;
        }

        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .sold-out { filter: grayscale(1); opacity: 0.6; pointer-events: none; position: relative; }
        .sold-out::after { 
            content: "SOLD OUT"; position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%) rotate(-15deg); 
            color: white; background: #dc2626; font-weight: 900; 
            padding: 5px 15px; border-radius: 5px; font-size: 14px; z-index: 10;
        }
        
        @keyframes pulse-red { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .blink-notif { animation: pulse-red 1s infinite; }
        #receipt-area { width: 58mm; padding: 15px; background: white; color: black; font-family: monospace; font-size: 12px; line-height: 1.3; }
        .receipt-hidden { position: absolute; left: -9999px; }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #00704A;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="pb-40">
    <nav class="bg-[#00704A] text-white p-4 sticky top-0 z-50 shadow-xl flex justify-between items-center">
        <div class="font-black tracking-tighter text-xl italic uppercase">KODPEN COFFEE</div>
        <button onclick="toggleMute()" class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center transition active:scale-90">
            <i id="muteIcon" class="fas fa-volume-up"></i>
        </button>
    </nav>

    <div class="container mx-auto px-4 py-6 max-w-md">
        <div class="text-center mb-6">
            <img src="https://raw.githubusercontent.com/kodpenlbt-cmd/Kodpen_Client/main/logo_kodpen.png" 
                 class="mx-auto w-20 mb-2 rounded-full border-4 border-white shadow-lg"
                 onerror="this.src='https://via.placeholder.com/100?text=KODPEN'">
            
            <div class="px-2 my-4">
                <img src="https://raw.githubusercontent.com/kodpenlbt-cmd/Kodpen_Client/main/ThisOurMenu.jpg" 
                     class="w-full max-w-sm mx-auto rounded-3xl shadow-2xl border-2 border-white object-cover"
                     alt="Our Menu"
                     onerror="this.style.display='none'">
            </div>

            <h2 class="text-xl font-black text-[#00704A] italic uppercase">"So Ba Kopi Bro?"</h2>
        </div>

        <div class="glass-card p-5 rounded-3xl shadow-md mb-4 border-b-4 border-[#00704A]">
            <label class="block font-black text-[10px] uppercase mb-2 text-gray-400">Nama Pemesan:</label>
            <input type="text" id="namaPelanggan" oninput="valBtn()" placeholder="Siapa nama Anda?" 
                   class="w-full p-4 bg-gray-50 border-2 border-gray-100 rounded-2xl font-bold outline-none focus:border-[#00704A] transition uppercase text-sm">
        </div>

        <div class="glass-card p-5 rounded-3xl shadow-md mb-6 border-b-4 border-[#00704A]">
            <label class="block font-black text-[10px] uppercase mb-2 text-gray-400">Pilih Nomor Meja Anda:</label>
            <select id="nomorMeja" onchange="valBtn()" class="w-full p-4 bg-gray-50 border-2 border-gray-100 rounded-2xl font-bold outline-none focus:border-[#00704A] transition">
                <option value="">-- Klik Untuk Pilih Meja --</option>
            </select>
        </div>

        <div id="menuContainer" class="space-y-6 mb-6">
            <div class="flex flex-col items-center justify-center py-20 text-gray-400 gap-3">
                <div class="loading-spinner"></div>
                <p class="font-bold uppercase text-[10px] tracking-widest">Menyiapkan Menu...</p>
            </div>
        </div>

        <div id="ringkasanContainer" class="hidden glass-card p-6 rounded-3xl shadow-lg mb-8 border-l-8 border-[#00704A] border-r-8">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <label class="font-black text-[10px] uppercase text-[#00704A] tracking-widest">Daftar Pilihan Anda:</label>
                <i class="fas fa-shopping-cart text-[#00704A]"></i>
            </div>
            <div id="ringkasanList" class="space-y-3 mb-4"></div>
            <div class="bg-gray-50 p-3 rounded-2xl flex justify-between items-center">
                <span class="font-black text-[10px] uppercase text-gray-400">Total Harga:</span>
                <span id="totalTextRingkasan" class="font-black text-lg text-[#00704A]">Rp 0</span>
            </div>
        </div>

        <div class="glass-card p-6 rounded-3xl shadow-lg mb-6">
            <label class="block font-black text-xs uppercase mb-4 text-gray-400 text-center tracking-widest">Pilih Pembayaran:</label>
            <div class="space-y-3">
                <label class="flex items-center p-4 border-2 border-gray-100 rounded-2xl cursor-pointer has-[:checked]:border-[#00704A] has-[:checked]:bg-green-50 transition active:scale-95">
                    <input type="radio" name="payment" value="Tunai" onchange="valBtn()" class="w-5 h-5 accent-[#00704A]">
                    <div class="ml-4"><p class="font-black text-sm uppercase">Tunai</p><p class="text-[9px] text-gray-400 font-bold uppercase">Bayar di Kasir</p></div>
                </label>
                <label class="flex items-center p-4 border-2 border-gray-100 rounded-2xl cursor-pointer has-[:checked]:border-[#00704A] has-[:checked]:bg-green-50 transition active:scale-95">
                    <input type="radio" name="payment" value="QRIS" onchange="valBtn()" class="w-5 h-5 accent-[#00704A]">
                    <div class="ml-4"><p class="font-black text-sm uppercase text-[#00704A]">QRIS / E-Wallet</p><p class="text-[9px] text-gray-400 font-bold uppercase">Scan Barcode</p></div>
                </label>
                <label class="flex items-center p-4 border-2 border-blue-100 rounded-2xl cursor-pointer has-[:checked]:border-blue-600 has-[:checked]:bg-blue-50 transition active:scale-95">
                    <input type="radio" name="payment" value="Transfer BNI" onchange="valBtn()" class="w-5 h-5 accent-blue-600">
                    <div class="ml-4"><p class="font-black text-blue-800 text-sm uppercase leading-none">Bank BNI</p><p class="text-blue-600 font-black text-base tracking-widest">0388924011</p></div>
                </label>
            </div>

            <div id="uploadArea" class="hidden mt-6 p-6 bg-gray-50 rounded-3xl border-2 border-dashed border-gray-300 text-center">
                <div id="qrisSection" class="hidden mb-4">
                    <img id="qrisImg" src="https://raw.githubusercontent.com/kodpenlbt-cmd/Kodpen_Client/main/Barcode.png" 
                         class="w-48 mx-auto rounded-2xl shadow-xl border-4 border-white mb-4" 
                         onerror="this.src='https://via.placeholder.com/200?text=QRIS+CODE'">
                    <button onclick="downloadQR()" class="bg-gray-800 text-white px-6 py-2 rounded-full text-[10px] font-black uppercase shadow-md mb-4 active:scale-90 transition">
                        <i class="fas fa-download mr-1"></i> Simpan Barcode
                    </button>
                </div>
                <p class="text-xs font-black text-red-600 mb-4 uppercase italic">Wajib Upload Bukti Transfer!</p>
                <input type="file" id="buktiFile" accept="image/*" onchange="valBtn()" class="text-xs w-full file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-black file:bg-[#00704A] file:text-white">
            </div>
        </div>

        <div id="statusContainer" class="hidden glass-card p-6 rounded-3xl shadow-2xl mb-6 border-t-4 border-[#00704A] text-center">
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="bg-gray-100 p-3 rounded-2xl border-2 border-gray-200">
                    <p class="text-[9px] font-black text-gray-400 uppercase leading-none mb-1">Antrean Anda</p>
                    <p id="txtNoAntrean" class="text-3xl font-black text-black">#0</p>
                </div>
                <div class="bg-[#D4E9E2] p-3 rounded-2xl border-2 border-[#00704A]">
                    <p class="text-[9px] font-black text-[#00704A] uppercase leading-none mb-1">Diproses</p>
                    <p id="txtSedangDiproses" class="text-3xl font-black text-[#00704A]">-</p>
                </div>
            </div>
            <div id="msgStatus" class="p-4 rounded-2xl font-black text-xs uppercase">Menunggu...</div>
            <button id="btnStopJemput" onclick="stopJemputAlarm()" class="hidden w-full mt-4 bg-blue-600 text-white py-4 rounded-2xl font-black text-xs uppercase shadow-lg active:scale-95 transition">Matikan Alarm / Jemput</button>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/95 backdrop-blur-md border-t border-gray-100 shadow-[0_-10px_25px_rgba(0,0,0,0.1)] z-40">
        <div class="max-w-md mx-auto">
            <div class="flex justify-between items-center mb-4 px-2">
                <span class="text-xs font-black text-gray-400 uppercase">Total Bayar:</span>
                <span id="totalHarga" class="text-3xl font-black text-[#00704A]">Rp 0</span>
            </div>
            <p id="payWarning" class="text-[10px] font-bold text-red-600 uppercase text-center mb-2 italic">Lengkapi Nama, Meja & Menu</p>
            <button id="btnPesan" onclick="kirimPesanan()" disabled class="btn-emboss w-full bg-[#00704A] text-white font-black py-5 rounded-3xl uppercase tracking-widest text-sm disabled:bg-gray-400">
                PESAN SEKARANG
            </button>
            <button id="btnMyBill" onclick="unduhStruk()" class="hidden btn-emboss w-full bg-blue-600 text-white font-black py-5 rounded-3xl uppercase text-xs mt-2">DOWNLOAD NOTA</button>
        </div>
    </div>

    <div class="receipt-hidden"><div id="receipt-area"></div></div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzUEXrabJW546ZIJT8H9TUxB2Jmw0-jcl2grIi2n8Q4dYPkI7UD7Apo6PC0Daa9DQL5tA/exec';
    
    let keranjang = {}; 
    let isMuted = false;
    let lastOrder = null;
    let alarmManuallyStopped = false;
    let pollingTimer = null;
    const soundJemput = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3'); 

    document.addEventListener('DOMContentLoaded', () => {
        initMeja(); 
        loadMenu();
        checkSavedOrder();
    });

    function cleanID(name) { return name.replace(/[^a-zA-Z0-9]/g, ''); }

    function initMeja() {
        const sel = document.getElementById('nomorMeja');
        const savedMeja = localStorage.getItem('kodpen_meja');
        const urlParams = new URLSearchParams(window.location.search);
        const mejaDariUrl = urlParams.get('meja');

        for(let i=1; i<=20; i++) {
            const opt = document.createElement('option');
            opt.value = i;
            opt.innerText = `MEJA ${i}`;
            if(mejaDariUrl == i) opt.selected = true;
            else if(!mejaDariUrl && savedMeja == i) opt.selected = true;
            sel.appendChild(opt);
        }
    }

    async function loadMenu() {
        try {
            const res = await fetch(`${scriptURL}?getMenu=true`);
            const menus = await res.json();
            renderMenu(menus);
            
            const savedCart = localStorage.getItem('kodpen_cart');
            if(savedCart && !localStorage.getItem('kodpen_id')) {
                keranjang = JSON.parse(savedCart);
                Object.keys(keranjang).forEach(name => {
                    const el = document.getElementById('q-' + cleanID(name));
                    if(el) el.innerText = keranjang[name].q;
                });
                updateRingkasan();
            }
        } catch (e) { 
            document.getElementById('menuContainer').innerHTML = "<p class='text-center text-red-500 font-bold py-10'>Gagal memuat menu. Cek koneksi Anda.</p>"; 
        }
    }

    function renderMenu(menus) {
        const container = document.getElementById('menuContainer'); 
        container.innerHTML = "";
        const categories = [...new Set(menus.map(m => m.cat))];
        categories.forEach(cat => {
            let catHtml = `<div class="mb-4"><h3 class="text-xs font-black uppercase tracking-widest border-l-4 border-[#00704A] pl-3 mb-4 text-gray-500">${cat}</h3><div class="grid grid-cols-1 gap-3">`;
            menus.filter(m => m.cat === cat).forEach(item => {
                const isClose = item.s === "Close";
                const itemID = cleanID(item.n);
                catHtml += `<div class="glass-card p-4 rounded-3xl flex justify-between items-center shadow-sm ${isClose ? 'sold-out' : 'active:bg-gray-50'}" onclick="${isClose ? '' : `qty('${item.n}',${item.h},1)`}">
                    <div class="flex-1">
                        <p class="font-black text-gray-800 text-sm uppercase">${item.n}</p>
                        <p class="text-xs font-bold text-[#00704A] mt-1">Rp ${Number(item.h).toLocaleString('id-ID')}</p>
                    </div>
                    <div class="flex items-center gap-4" onclick="event.stopPropagation()">
                        <button onclick="qty('${item.n}',${item.h},-1)" class="w-10 h-10 rounded-2xl bg-gray-100 flex items-center justify-center font-black">-</button>
                        <span id="q-${itemID}" class="font-black text-sm w-4 text-center">0</span>
                        <button onclick="qty('${item.n}',${item.h},1)" class="w-10 h-10 rounded-2xl bg-[#00704A] text-white flex items-center justify-center font-black shadow-md">+</button>
                    </div>
                </div>`;
            });
            container.innerHTML += catHtml + `</div></div>`;
        });
    }

    function qty(n, h, c) {
        if(localStorage.getItem('kodpen_id')) return;
        if(!keranjang[n]) keranjang[n] = {q:0, h:h};
        keranjang[n].q += c; 
        if(keranjang[n].q < 0) keranjang[n].q = 0;
        
        const el = document.getElementById('q-' + cleanID(n));
        if(el) el.innerText = keranjang[n].q;
        
        localStorage.setItem('kodpen_cart', JSON.stringify(keranjang));
        updateRingkasan();
    }

    function updateRingkasan() {
        const cont = document.getElementById('ringkasanContainer');
        const list = document.getElementById('ringkasanList');
        let total = 0; 
        list.innerHTML = "";
        
        Object.keys(keranjang).forEach(k => {
            if(keranjang[k].q > 0) {
                const sub = keranjang[k].q * keranjang[k].h; total += sub;
                list.innerHTML += `<div class="flex justify-between items-center text-[11px] font-bold text-gray-700 uppercase"><span>${k} (x${keranjang[k].q})</span><span>Rp ${sub.toLocaleString('id-ID')}</span></div>`;
            }
        });

        cont.classList.toggle('hidden', total === 0);
        document.getElementById('totalHarga').innerText = "Rp " + total.toLocaleString('id-ID');
        document.getElementById('totalTextRingkasan').innerText = "Rp " + total.toLocaleString('id-ID');
        valBtn();
    }

    function valBtn() {
        const nama = document.getElementById('namaPelanggan').value.trim();
        const meja = document.getElementById('nomorMeja').value;
        if(meja) localStorage.setItem('kodpen_meja', meja);

        const payInput = document.querySelector('input[name="payment"]:checked');
        const totalText = document.getElementById('totalHarga').innerText;
        const total = parseInt(totalText.replace(/[^0-9]/g, '')) || 0;
        const btn = document.getElementById('btnPesan');
        const warning = document.getElementById('payWarning');
        const file = document.getElementById('buktiFile');
        const isDigitalPay = payInput && payInput.value !== 'Tunai';

        document.getElementById('uploadArea').classList.toggle('hidden', !isDigitalPay);
        document.getElementById('qrisSection').classList.toggle('hidden', !(payInput && payInput.value === 'QRIS'));

        if (total > 0 && meja && nama && payInput) {
            if (!isDigitalPay || file.files.length > 0) { 
                btn.disabled = false; 
                warning.classList.add('hidden'); 
            } else { 
                btn.disabled = true; 
                warning.innerText = "Wajib Upload Bukti!"; warning.classList.remove('hidden'); 
            }
        } else { 
            btn.disabled = true; 
            warning.classList.remove('hidden'); 
            warning.innerText = "Lengkapi Nama, Meja & Menu";
        }
    }

    async function kirimPesanan() {
        const btn = document.getElementById('btnPesan');
        btn.disabled = true;
        btn.innerText = "MENGIRIM...";

        try {
            const meja = document.getElementById('nomorMeja').value;
            const nama = document.getElementById('namaPelanggan').value.toUpperCase();
            let detail = ""; 
            Object.keys(keranjang).forEach(k => { if(keranjang[k].q > 0) detail += `${k} (x${keranjang[k].q}), `; });
            
            const orderId = "ORD-" + new Date().getTime();
            const pay = document.querySelector('input[name="payment"]:checked').value;
            let f64 = ""; 
            const fi = document.getElementById('buktiFile');
            
            if(fi.files.length > 0) { 
                f64 = await new Promise(r => { const rd = new FileReader(); rd.onload = () => r(rd.result); rd.readAsDataURL(fi.files[0]); }); 
            }
            
            lastOrder = { 
                orderId, nama, meja, 
                pesanan: detail.slice(0,-2), 
                pembayaran: pay, 
                total: document.getElementById('totalHarga').innerText, 
                date: new Date().toLocaleString('id-ID') 
            };
            
            const response = await fetch(scriptURL, { 
                method: 'POST', 
                body: JSON.stringify({...lastOrder, fileBase64: f64, fileName: fi.files[0]?.name}) 
            });
            const resData = await response.json();

            if(resData.result === "success") {
                localStorage.setItem('kodpen_id', orderId); 
                localStorage.setItem('kodpen_data', JSON.stringify(lastOrder)); 
                localStorage.removeItem('kodpen_cart'); 
                window.location.reload(); 
            } else {
                alert("Gagal mengirim pesanan: " + resData.message);
                btn.disabled = false;
                btn.innerText = "PESAN SEKARANG";
            }
        } catch (err) {
            alert("Error Koneksi: Silakan coba lagi.");
            btn.disabled = false;
            btn.innerText = "PESAN SEKARANG";
        }
    }

    function checkSavedOrder() {
        const sid = localStorage.getItem('kodpen_id'); 
        const sdt = localStorage.getItem('kodpen_data');
        if(sid && sdt) {
            lastOrder = JSON.parse(sdt);
            document.getElementById('btnPesan').classList.add('hidden');
            document.getElementById('statusContainer').classList.remove('hidden');
            document.getElementById('btnMyBill').classList.remove('hidden');
            document.getElementById('payWarning').classList.add('hidden');

            const cont = document.getElementById('ringkasanContainer');
            const list = document.getElementById('ringkasanList');
            cont.classList.remove('hidden');
            list.innerHTML = `<div class="mb-2 text-[#00704A] font-black text-xs">PEMESAN: ${lastOrder.nama}</div>`;
            lastOrder.pesanan.split(', ').forEach(item => {
                list.innerHTML += `<div class="flex justify-between items-center text-[11px] font-bold text-gray-700 uppercase"><span>${item}</span></div>`;
            });
            document.getElementById('totalHarga').innerText = lastOrder.total;
            document.getElementById('totalTextRingkasan').innerText = lastOrder.total;
            
            const inputNama = document.getElementById('namaPelanggan');
            inputNama.value = lastOrder.nama;
            inputNama.disabled = true;
            document.getElementById('nomorMeja').disabled = true;

            startPolling(sid);
        }
    }

    function startPolling(id) {
        if(pollingTimer) clearInterval(pollingTimer);
        pollingTimer = setInterval(() => {
            if(document.hidden) return; 

            fetch(`${scriptURL}?orderId=${id}`).then(r => r.json()).then(data => {
                if(data.status === "NotFound") { localStorage.clear(); location.reload(); return; }
                
                document.getElementById('txtNoAntrean').innerText = "#" + data.antrean;
                document.getElementById('txtSedangDiproses').innerText = (!data.sedangDiproses) ? "-" : "#" + data.sedangDiproses;
                
                const msg = document.getElementById('msgStatus');
                if(data.status === "Antri") {
                    if(lastOrder.pembayaran === "Tunai") {
                        msg.innerHTML = "BAYAR DI KASIR SEKARANG!<br><span class='text-[9px]'>Agar segera dibuatkan barista</span>";
                        msg.className = "p-4 rounded-2xl font-black text-xs bg-red-100 text-red-600 blink-notif border-2 border-red-600";
                    } else {
                        msg.innerText = "Menunggu Konfirmasi...";
                        msg.className = "p-4 rounded-2xl font-black text-xs bg-gray-100 text-gray-400 uppercase";
                    }
                } else if(data.status === "Proses") {
                    msg.innerText = "Pesanan Sedang Dibuat â˜•";
                    msg.className = "p-4 rounded-2xl font-black text-xs bg-[#00704A] text-white shadow-md";
                    alarmManuallyStopped = false;
                } else if(data.status === "Jemput") {
                    msg.innerText = "PESANAN SIAP! SILAKAN JEMPUT ðŸ””";
                    msg.className = "p-4 rounded-2xl font-black text-xs bg-blue-600 text-white shadow-xl blink-notif";
                    document.getElementById('btnStopJemput').classList.remove('hidden');
                    if(!isMuted && !alarmManuallyStopped) soundJemput.play().catch(()=>{});
                } else if(data.status === "Selesai") {
                    localStorage.clear(); 
                    clearInterval(pollingTimer);
                    alert("Terima kasih sudah memesan! Sampai jumpa kembali.");
                    location.reload();
                }
            }).catch(e => console.log("Polling error..."));
        }, 6000);
    }

    function stopJemputAlarm() { 
        soundJemput.pause(); soundJemput.currentTime = 0;
        alarmManuallyStopped = true; 
        document.getElementById('btnStopJemput').innerText = "MENJEMPUT..."; 
        document.getElementById('btnStopJemput').classList.replace('bg-blue-600', 'bg-gray-400');
    }

    function toggleMute() { 
        isMuted = !isMuted; 
        document.getElementById('muteIcon').className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up'; 
    }

    function downloadQR() { const a = document.createElement('a'); a.href = document.getElementById('qrisImg').src; a.download = 'QRIS_KODPEN.png'; a.click(); }

    function unduhStruk() {
        if(!lastOrder) return;
        const area = document.getElementById('receipt-area');
        area.innerHTML = `
            <div style="text-align:center">
                <strong style="font-size:16px">KODPEN COFFEE</strong><br>
                Official Order Receipt<br>
                ----------------------------<br>
                NO ANTREAN: ${document.getElementById('txtNoAntrean').innerText}<br>
                ----------------------------
            </div>
            <div style="margin:10px 0">
                NAMA: ${lastOrder.nama}<br>
                MEJA: ${lastOrder.meja}<br>
                TGL : ${lastOrder.date}
            </div>
            ----------------------------<br>
            <div style="text-align:left">
                ${lastOrder.pesanan.split(', ').join('<br>')}
            </div>
            ----------------------------<br>
            <div style="text-align:right">
                <strong>TOTAL: ${lastOrder.total}</strong><br>
                PAY: ${lastOrder.pembayaran}
            </div>
            <br>
            <div style="text-align:center; font-style:italic">"So Ba Kopi Bro?"</div>
        `;
        html2canvas(area, {scale:2}).then(c => { 
            const a = document.createElement('a'); 
            a.download = `Nota_KODPEN_${lastOrder.orderId}.png`; 
            a.href = c.toDataURL(); 
            a.click(); 
        });
    }
</script>
</body>
</html>
